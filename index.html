<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <title>Stoppuhr</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        html, body { height: 100%; overscroll-behavior: none; -ms-touch-action: manipulation; touch-action: manipulation; }
        body {
            font-family: "SF Pro Display", "SF Pro Text", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            background:#000;
            color:#fff;
            display:flex;
            flex-direction:column;
            min-height:100vh;
            overflow:hidden; /* kein Scrollen */
            -webkit-overflow-scrolling: auto;
        }

        .status-bar { display:flex; justify-content:flex-end; align-items:center; padding:10px 18px; font-size:17px; font-weight:600; color:#fff; }

        /* Container füllt die Höhe, damit wir absolute Positionen innerhalb verwenden können */
        .stopwatch-container {
            position:relative;
            height: calc(100vh - 86px); /* Platz lassen für bottom-nav (ca. 86px) */
            padding: 20px 12px 0 12px;
            display:flex;
            flex-direction:column;
            align-items:center;
            min-height:0;
        }

        /* Zeit-Anzeige: 10px nach unten verschoben gegenüber vorher (margin-top 14 -> 24) */
        .time-display {
            font-family: "SF Pro Display","SF Pro Text",-apple-system,system-ui,"Helvetica Neue",Arial;
            font-weight:100;
            font-size:110px;
            line-height:1;
            letter-spacing:-3px;
            margin-top:24px; /* +10px gegenüber vorher */
            margin-bottom:36px;
            -webkit-font-smoothing:antialiased;
            font-variant-numeric: tabular-nums;
            text-rendering: optimizeLegibility;
            white-space: nowrap;
            user-select: none;
            z-index: 5;
        }

        /* Controls: absolut positioniert so dass der Mittelpunkt der Buttons auf 50% des Viewports liegt */
        .controls {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            top: calc(50% - 44px); /* 44px = halbe Button-Höhe -> Mittelpunkt der Buttons bei 50% */
            width: 100%;
            max-width:420px;
            height: 100px;
            display: block;
            margin: 0;
            z-index: 20;
        }

        .control-button {
            position: absolute;
            width: 88px;
            height: 88px;
            border-radius: 50%;
            border: none;
            font-size: 18px;
            font-weight: 400;
            cursor: pointer;
            display:flex;
            align-items:center;
            justify-content:center;
            padding:0;
            transition: transform .08s ease;
            user-select:none;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }
        .control-button:active { transform: scale(0.96); }

        /* Links/rechts Buttons bleiben am Rand innerhalb controls */
        .control-button.left { left: 14px; top: 6px; }   /* top 6px damit optisch zentriert innerhalb controls */
        .control-button.right { right: 14px; top: 6px; }

        .left-idle { background:#1C1B1E; color:#9A9AA0; }
        .left-running, .left-stopped { background:#2C2C2E; color:#fff; }
        .right-idle { background: rgba(39,108,58,0.12); color:#30D058; }
        .right-running { background: rgba(255,68,58,0.12); color:#FF453A; }
        .right-stopped { background: rgba(39,108,58,0.12); color:#30D058; }

        /* Dots: auf Höhe der Button-Mittelpunkte (44px innerhalb controls) */
        .dots {
            position: absolute;
            left: 50%;
            top: 44px; /* Mitte der 88px Buttons */
            transform: translateX(-50%);
            display:flex;
            gap:12px;
            align-items:center;
            justify-content:center;
            z-index: 10;
            pointer-events:none;
        }
        .dot { width:6px; height:6px; border-radius:50%; background:#333; }
        .dot.active { background:#fff; }

        .separator-line { width:100%; max-width:420px; height:1px; background:#2C2C2E; margin-top:6px; position: absolute; top: calc(50% + 56px); /* etwas unterhalb der Buttons */ left: 50%; transform: translateX(-50%); }

        .laps-container {
            position: absolute;
            top: calc(50% + 64px); /* Bereich unter den Buttons */
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            max-width:420px;
            bottom: 0;
            overflow:auto;
            padding-bottom:12px;
        }

        .lap-item { display:flex; justify-content:space-between; align-items:center; padding:12px 0; border-bottom:1px solid #2C2C2E; color:#fff; font-size:16px; font-weight:400; }
        .lap-item:last-child { border-bottom:none; }
        .lap-item.fastest { color:#30D058; }
        .lap-item.slowest { color:#FF453A; }

        /* bottom-nav bleibt an gleicher Höhe wie vorher */
        .bottom-nav {
            height: 86px; /* sicherstellen gleiche Höhe */
            display:flex;
            justify-content:space-around;
            align-items:flex-end;
            padding: 8px 6px 8px 6px;
            background:transparent;
            gap:6px;
        }
        .nav-item { display:flex; flex-direction:column; align-items:center; gap:6px; color:#7D7D7D; font-size:11px; font-weight:600; width:72px; }
        .nav-item.active { color:#F4A30F; }
        .nav-icon { width:28px; height:24px; display:flex; align-items:center; justify-content:center; }

        /* Home indicator entfernt (unsichtbar), bottom-nav bleibt */
        .home-indicator { display:none !important; }

        @media (max-width:420px){
            .time-display { font-size:86px; letter-spacing:-2px; margin-bottom:22px; }
            .control-button { width:78px; height:78px; font-size:16px; }
            .control-button.left { left:12px; top: 6px; }
            .control-button.right { right:12px; top: 6px; }
            .dots { top:39px; }
        }
        @media (max-height:700px){
            .time-display { font-size:74px; letter-spacing:-1px; margin-bottom:12px; }
        }
    </style>
</head>
<body>
    <div class="status-bar"><div style="height:20px;"></div></div>

    <div class="stopwatch-container">
        <div class="time-display" id="timeDisplay">00:00,00</div>

        <div class="controls" aria-hidden="false">
            <button id="leftButton" class="control-button left left-idle" disabled>Runde</button>
            <button id="rightButton" class="control-button right right-idle">Start</button>

            <div class="dots" aria-hidden="true">
                <div class="dot active"></div>
                <div class="dot"></div>
            </div>
        </div>

        <div class="separator-line" aria-hidden="true"></div>

        <div class="laps-container" id="lapsContainer"></div>
    </div>

    <div class="bottom-nav" role="navigation" aria-label="Uhr Navigation">
        <!-- Dein angepasstes Weltuhr-Icon -->
        <div class="nav-item">
            <div class="nav-icon" aria-hidden="true">
                <svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="9"></circle>
                    <path d="M12 3v18"></path>
                    <path d="M12 3 C7.5 7.5, 7.5 16.5, 12 21"></path>
                    <path d="M12 3 C16.5 7.5, 16.5 16.5, 12 21"></path>
                    <path d="M5.2 7.2c2 1.2 6 1.8 13.6 0"></path>
                    <path d="M4 12h16"></path>
                    <path d="M5.2 16.8c2-1.2 6-1.8 13.6 0"></path>
                </svg>
            </div>
            <div>Weltuhr</div>
        </div>

        <!-- restliche Icons unverändert -->
        <div class="nav-item"><div class="nav-icon">…</div><div>Wecker</div></div>
        <div class="nav-item active"><div class="nav-icon">…</div><div>Stoppuhr</div></div>
        <div class="nav-item"><div class="nav-icon">…</div><div>Timer</div></div>
    </div>

    <!-- home-indicator entfernt / ausgeblendet -->
    <div class="home-indicator" aria-hidden="true"></div>

    <script>
        // --- Stoppuhr-Logik (unverändert) ---
        let startTime = 0;
        let elapsedTime = 0;
        let timerInterval = null;
        let isRunning = false;
        let lapCounter = 0;
        let laps = [];
        let currentLapStartTime = 0;

        const timeDisplay = document.getElementById('timeDisplay');
        const leftButton = document.getElementById('leftButton');
        const rightButton = document.getElementById('rightButton');
        const lapsContainer = document.getElementById('lapsContainer');

        function formatTime(milliseconds) {
            const totalSeconds = Math.floor(milliseconds / 1000);
            const minutes = Math.floor(totalSeconds / 60);
            const seconds = totalSeconds % 60;
            const centiseconds = Math.floor((milliseconds % 1000) / 10);
            return `${minutes.toString().padStart(2,'0')}:${seconds.toString().padStart(2,'0')},${centiseconds.toString().padStart(2,'0')}`;
        }

        function timeStringToMs(timeString) {
            const parts = timeString.split(':');
            const minutes = parseInt(parts[0],10) || 0;
            const secondsParts = (parts[1] || '00').split(',');
            const seconds = parseInt(secondsParts[0],10) || 0;
            const centiseconds = parseInt(secondsParts[1],10) || 0;
            return (minutes * 60 + seconds) * 1000 + centiseconds * 10;
        }

        function updateDisplay() {
            const now = Date.now();
            const total = elapsedTime + (isRunning ? (now - startTime) : 0);
            timeDisplay.textContent = formatTime(total);

            if (laps.length > 0 && laps[0].isCurrent) {
                let currentLapElapsed;
                if (isRunning) currentLapElapsed = now - currentLapStartTime;
                else currentLapElapsed = timeStringToMs(laps[0].time);
                laps[0].time = formatTime(currentLapElapsed);
                updateLapsDisplay();
            }
        }

        function startStopwatch() {
            isRunning = true;
            startTime = Date.now();

            if (lapCounter === 0) {
                currentLapStartTime = startTime;
                lapCounter = 1;
                laps.unshift({ number: lapCounter, time: '00:00,00', isCurrent: true });
                updateLapsDisplay();
            }

            timerInterval = setInterval(updateDisplay, 10);

            rightButton.textContent = 'Stopp';
            rightButton.className = 'control-button right right-running';
            leftButton.textContent = 'Runde';
            leftButton.className = 'control-button left left-running';
            leftButton.disabled = false;
        }

        function stopStopwatch() {
            isRunning = false;
            elapsedTime += Date.now() - startTime;
            clearInterval(timerInterval);

            if (laps.length > 0 && laps[0].isCurrent) {
                const currentLapElapsed = Date.now() - currentLapStartTime;
                laps[0].time = formatTime(currentLapElapsed);
                updateLapsDisplay();
            }

            rightButton.textContent = 'Weiter';
            rightButton.className = 'control-button right right-stopped';
            leftButton.textContent = 'Löschen';
            leftButton.className = 'control-button left left-stopped';
        }

        function resetStopwatch() {
            isRunning = false;
            elapsedTime = 0;
            lapCounter = 0;
            laps = [];
            currentLapStartTime = 0;
            clearInterval(timerInterval);
            timeDisplay.textContent = '00:00,00';

            rightButton.textContent = 'Start';
            rightButton.className = 'control-button right right-idle';
            leftButton.textContent = 'Runde';
            leftButton.className = 'control-button left left-idle';
            leftButton.disabled = true;

            updateLapsDisplay();
        }

        function recordLap() {
            const now = Date.now();

            if (laps.length > 0 && laps[0].isCurrent) laps[0].isCurrent = false;

            lapCounter++;
            currentLapStartTime = now;
            laps.unshift({ number: lapCounter, time: '00:00,00', isCurrent: true });
            updateLapsDisplay();
        }

        function updateLapsDisplay() {
            lapsContainer.innerHTML = '';

            const completedLaps = laps.filter(l => !l.isCurrent);
            let fastest = null, slowest = null, fastestIdx = -1, slowestIdx = -1;

            if (completedLaps.length >= 2) {
                completedLaps.forEach(lap => {
                    const ms = timeStringToMs(lap.time);
                    if (fastest === null || ms < fastest) { fastest = ms; fastestIdx = laps.indexOf(lap); }
                    if (slowest === null || ms > slowest) { slowest = ms; slowestIdx = laps.indexOf(lap); }
                });
            }

            laps.forEach((lap, idx) => {
                const el = document.createElement('div');
                let cls = 'lap-item';
                if (!lap.isCurrent && completedLaps.length >= 2) {
                    if (idx === fastestIdx) cls += ' fastest';
                    else if (idx === slowestIdx) cls += ' slowest';
                }
                el.className = cls;
                el.innerHTML = `<span class="lap-number">Runde ${lap.number}</span><span class="lap-time">${lap.time}</span>`;
                lapsContainer.appendChild(el);
            });
        }

        // Button-Events
        rightButton.addEventListener('click', () => {
            if (!isRunning && elapsedTime === 0) startStopwatch();
            else if (isRunning) stopStopwatch();
            else startStopwatch();
        });

        leftButton.addEventListener('click', () => {
            if (isRunning) recordLap();
            else if (elapsedTime > 0) resetStopwatch();
        });

        leftButton.disabled = true;
        updateDisplay();

        /* ---------------------- Fullscreen & scroll/zoom prevention (beibehalten) ---------------------- */
        function tryEnterFullscreen() {
            const el = document.documentElement;
            if (document.fullscreenElement || document.webkitFullscreenElement || document.msFullscreenElement) return;
            const fn = el.requestFullscreen || el.webkitRequestFullscreen || el.msRequestFullscreen;
            if (fn) {
                try { fn.call(el); } catch (err) { /* ignore */ }
            }
        }
        const enterOnce = () => { tryEnterFullscreen(); document.removeEventListener('click', enterOnce); document.removeEventListener('touchstart', enterOnce); };
        document.addEventListener('click', enterOnce, { once: true });
        document.addEventListener('touchstart', enterOnce, { once: true });

        document.addEventListener('touchmove', function(e){ e.preventDefault(); }, { passive: false });
        let lastTouch = 0;
        document.addEventListener('touchend', function(e){
            const now = Date.now();
            if (now - lastTouch <= 300) e.preventDefault();
            lastTouch = now;
        }, { passive: false });
        document.addEventListener('gesturestart', function(e){ e.preventDefault && e.preventDefault(); });
        document.addEventListener('dblclick', function(e){ e.preventDefault(); });
        window.addEventListener('keydown', function(e){
            const keysToPrevent = ['ArrowUp','ArrowDown','PageUp','PageDown','Home','End',' '];
            if (keysToPrevent.includes(e.key)) e.preventDefault();
        }, { passive: false });
    </script>
</body>
</html>
