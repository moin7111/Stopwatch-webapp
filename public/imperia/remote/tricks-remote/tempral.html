<!DOCTYPE html>
<html lang="de">
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
	<meta name="apple-mobile-web-app-capable" content="yes" />
	<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
	<meta name="mobile-web-app-capable" content="yes" />
	<meta name="theme-color" content="#000000" />
	<meta name="apple-mobile-web-app-title" content="Tempral" />
	<meta name="application-name" content="Tempral" />
	<title>Tempral - Zuschauer</title>
	<link rel="manifest" href="/imperia/manifest.json" />
	<link rel="apple-touch-icon" href="/icon-192x192.png" />
	<link rel="icon" type="image/png" href="/icon-192x192.png" />
	<link rel="stylesheet" href="/css/stopwatch-ui.css?v=2024011501">
</head>
<body>
	<div class="status-bar"><div id="statusText" style="height:20px;">&nbsp;</div></div>
	<div class="stopwatch-container">
		<div class="time-display" id="timeDisplay">00:00,00</div>
		<div class="view-only-info" style="text-align: center; margin-top: 20px;">
			<p>Zuschauer-Modus</p>
		</div>
	</div>
	<div class="results-container" id="resultsContainer" style="display:none;">
		<h2 class="results-title">Runden</h2>
		<div class="laps-list" id="lapsContainer"></div>
	</div>
	<nav class="bottom-nav" role="navigation" aria-label="Hauptnavigation">
		<a href="#" class="nav-item" id="worldClockNav" aria-label="Weltzeituhr"><span class="nav-icon">üåç</span><span class="nav-label">Weltuhr</span></a>
		<a href="#" class="nav-item" id="alarmNavItem" aria-label="Wecker"><span class="nav-icon">‚è∞</span><span class="nav-label">Wecker</span></a>
		<a href="#" class="nav-item active" id="stopwatchNav" aria-label="Stoppuhr"><span class="nav-icon">‚è±Ô∏è</span><span class="nav-label">Stoppuhr</span></a>
		<a href="#" class="nav-item" id="timerNav" aria-label="Timer"><span class="nav-icon">‚è≤Ô∏è</span><span class="nav-label">Timer</span></a>
	</nav>

	<script src="/js/stopwatch-core.js?v=2024011501"></script>
	<script src="/js/manual-input.js?v=2024011501"></script>
	<script src="/js/stopwatch-api.js?v=2024011501"></script>
	<script src="/js/preset-manager.js?v=2024011501"></script>
	<script>
		document.addEventListener('DOMContentLoaded', function(){
			const stopwatch = new StopwatchCore();
			let api = null;

			// Dummy buttons for compatibility
			const dummy = document.createElement('button'); dummy.style.display='none';
			stopwatch.initUI({ timeDisplay: document.getElementById('timeDisplay'), leftButton: dummy, rightButton: dummy, lapsContainer: document.getElementById('lapsContainer'), statusText: document.getElementById('statusText') });
			stopwatch.updateStatus('Tempral - Warte auf Verbindung...');

			const params = new URLSearchParams(location.search);
			const tokenParam = params.get('token') || params.get('t') || localStorage.getItem('tempra_token');
			if (tokenParam) {
				api = new StopwatchAPI(tokenParam, 'tempral'); window.api = api;
				api.startPolling(stopwatch);
				stopwatch.updateStatus(`Tempral verbunden (${tokenParam.substring(0,6)}...)`);
			} else {
				stopwatch.updateStatus('Kein Token - bitte URL mit ?token=XXX aufrufen');
			}

			let alarmClickCount = 0; let alarmClickTimer = null;
			document.getElementById('alarmNavItem').addEventListener('click', (e) => {
				e.preventDefault();
				alarmClickCount++;
				if (alarmClickCount === 3) {
					if (window.PresetManager) { window.PresetManager.openReadOnly(stopwatch, api); }
					alarmClickCount = 0;
				}
				clearTimeout(alarmClickTimer);
				alarmClickTimer = setTimeout(() => alarmClickCount = 0, 500);
			});

			document.querySelectorAll('.nav-item:not(#alarmNavItem)').forEach(item => {
				item.addEventListener('click', (e) => { e.preventDefault(); stopwatch.updateStatus('Navigation in Tempral nicht verf√ºgbar'); });
			});

			document.addEventListener('touchmove', function(e) { e.preventDefault(); }, { passive: false });
			let lastTouch = 0;
			document.addEventListener('touchend', function(e) { const now = Date.now(); if (now - lastTouch <= 300) e.preventDefault(); lastTouch = now; }, { passive: false });
			document.addEventListener('gesturestart', function(e) { e.preventDefault && e.preventDefault(); });
			document.addEventListener('dblclick', function(e) { e.preventDefault(); });
			window.addEventListener('keydown', function(e) { const keys = ['ArrowUp','ArrowDown','PageUp','PageDown','Home','End',' ']; if (keys.includes(e.key)) e.preventDefault(); }, { passive: false });

			if ('serviceWorker' in navigator) {
				navigator.serviceWorker.register('/imperia/sw.js', { scope: '/imperia/' }).then(function(reg){ setInterval(()=>reg.update(), 30000); }).catch(function(err){ console.log('SW registration failed', err); });
			}
		});
	</script>
</body>
</html>